'use client';

import { useEffect, useState, useCallback, useRef } from 'react';
import { useAuth } from '../../hooks/useAuth';
import { useRouter } from 'next/navigation';
import { getSupabaseBrowserClient } from '@/lib/supabaseClient';
import { FiActivity, FiAlertCircle, FiCheckCircle, FiMic, FiMicOff, FiRefreshCw } from 'react-icons/fi';

// ElevenLabs Agent ID
const ELEVENLABS_AGENT_ID = "agent_3401k9m6k2f7fv78tav8pd9x79ca";

interface MonitoringMetrics {
  active_vessels: number;
  fishing_vessels: number;
  transactions_today: number;
  active_alerts: number;
  system_health: string;
  blockchain_sync: string;
}

interface Alert {
  id: string;
  severity: string;
  type: string;
  message: string;
  timestamp: string;
}

interface LiveEvent {
  id: string;
  type: string;
  description: string;
  timestamp: string;
  severity: string;
}

export default function LiveMonitoringPage() {
  const router = useRouter();
  const { user, isLoading } = useAuth();
  const [accessToken, setAccessToken] = useState<string | null>(null);
  
  const [metrics, setMetrics] = useState<MonitoringMetrics | null>(null);
  const [aiSummary, setAiSummary] = useState<string>('');
  const [alerts, setAlerts] = useState<Alert[]>([]);
  const [liveEvents, setLiveEvents] = useState<LiveEvent[]>([]);
  const [fleetAnalysis, setFleetAnalysis] = useState<string>('');
  const [isVoiceActive, setIsVoiceActive] = useState(false);
  const [isRefreshing, setIsRefreshing] = useState(false);
  const [lastUpdate, setLastUpdate] = useState<Date>(new Date());
  const [agentStatus, setAgentStatus] = useState<'idle' | 'listening' | 'thinking' | 'speaking'>('idle');
  const [audioLevel, setAudioLevel] = useState(0);
  const [conversationHistory, setConversationHistory] = useState<Array<{role: 'user' | 'agent', message: string, timestamp: Date}>>([]);
  
  const conversationRef = useRef<any>(null);
  const audioRef = useRef<HTMLAudioElement | null>(null);
  const audioContextRef = useRef<AudioContext | null>(null);
  const analyserRef = useRef<AnalyserNode | null>(null);
  const animationFrameRef = useRef<number | null>(null);
  const canvasRef = useRef<HTMLCanvasElement | null>(null);
  const waveformData = useRef<number[]>(new Array(128).fill(0));

  // Get access token
  useEffect(() => {
    const getToken = async () => {
      const supabase = getSupabaseBrowserClient();
      const { data } = await supabase.auth.getSession();
      if (data.session?.access_token) {
        setAccessToken(data.session.access_token);
      }
    };
    if (user) {
      getToken();
    }
  }, [user]);

  // Fetch monitoring data
  const fetchMonitoringData = useCallback(async () => {
    if (!accessToken) return;
    
    try {
      const response = await fetch('http://127.0.0.1:8000/monitoring/status', {
        headers: {
          'Authorization': `Bearer ${accessToken}`
        }
      });
      
      if (response.ok) {
        const data = await response.json();
        setMetrics(data.metrics);
        setAiSummary(data.ai_summary);
        setAlerts(data.alerts || []);
        setLastUpdate(new Date());
      }
    } catch (error) {
      console.error('Failed to fetch monitoring data:', error);
    }
  }, [accessToken]);

  // Fetch live feed
  const fetchLiveFeed = useCallback(async () => {
    if (!accessToken) return;
    
    try {
      const response = await fetch('http://127.0.0.1:8000/monitoring/live-feed?limit=20', {
        headers: {
          'Authorization': `Bearer ${accessToken}`
        }
      });
      
      if (response.ok) {
        const data = await response.json();
        setLiveEvents(data.events || []);
      }
    } catch (error) {
      console.error('Failed to fetch live feed:', error);
    }
  }, [accessToken]);

  // Fetch fleet analysis
  const fetchFleetAnalysis = useCallback(async () => {
    if (!accessToken) return;
    
    try {
      const response = await fetch('http://127.0.0.1:8000/monitoring/fleet-analysis', {
        headers: {
          'Authorization': `Bearer ${accessToken}`
        }
      });
      
      if (response.ok) {
        const data = await response.json();
        setFleetAnalysis(data.analysis?.analysis || '');
      }
    } catch (error) {
      console.error('Failed to fetch fleet analysis:', error);
    }
  }, [accessToken]);

  // Refresh all data
  const refreshAll = useCallback(async () => {
    setIsRefreshing(true);
    await Promise.all([
      fetchMonitoringData(),
      fetchLiveFeed(),
      fetchFleetAnalysis()
    ]);
    setIsRefreshing(false);
  }, [fetchMonitoringData, fetchLiveFeed, fetchFleetAnalysis]);

  // Initial data fetch
  useEffect(() => {
    if (user && accessToken) {
      refreshAll();
    }
  }, [user, accessToken, refreshAll]);

  // Auto-refresh every 30 seconds
  useEffect(() => {
    if (!user || !accessToken) return;
    
    const interval = setInterval(() => {
      fetchMonitoringData();
      fetchLiveFeed();
    }, 30000);
    
    return () => clearInterval(interval);
  }, [user, accessToken, fetchMonitoringData, fetchLiveFeed]);

  // Professional Audio Visualization with Canvas
  const startAudioVisualization = useCallback(async () => {
    try {
      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
      const audioContext = new AudioContext();
      const analyser = audioContext.createAnalyser();
      const microphone = audioContext.createMediaStreamSource(stream);
      
      analyser.fftSize = 2048;
      analyser.smoothingTimeConstant = 0.8;
      microphone.connect(analyser);
      
      audioContextRef.current = audioContext;
      analyserRef.current = analyser;
      
      const bufferLength = analyser.frequencyBinCount;
      const dataArray = new Uint8Array(bufferLength);
      const canvas = canvasRef.current;
      
      const animate = () => {
        if (!canvas) {
          animationFrameRef.current = requestAnimationFrame(animate);
          return;
        }
        
        const ctx = canvas.getContext('2d');
        if (!ctx) return;
        
        analyser.getByteTimeDomainData(dataArray);
        
        // Calculate average volume
        const average = dataArray.reduce((a, b) => a + b) / dataArray.length;
        setAudioLevel((average - 128) / 128);
        
        // Clear canvas with fade effect
        ctx.fillStyle = 'rgba(10, 10, 10, 0.3)';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        
        // Draw waveform
        ctx.lineWidth = 2;
        ctx.strokeStyle = '#00d9ff';
        ctx.shadowBlur = 10;
        ctx.shadowColor = '#00d9ff';
        ctx.beginPath();
        
        const sliceWidth = canvas.width / bufferLength;
        let x = 0;
        
        for (let i = 0; i < bufferLength; i++) {
          const v = dataArray[i] / 128.0;
          const y = (v * canvas.height) / 2;
          
          if (i === 0) {
            ctx.moveTo(x, y);
          } else {
            ctx.lineTo(x, y);
          }
          
          x += sliceWidth;
        }
        
        ctx.lineTo(canvas.width, canvas.height / 2);
        ctx.stroke();
        
        // Draw frequency bars
        analyser.getByteFrequencyData(dataArray);
        const barCount = 64;
        const barWidth = canvas.width / barCount;
        
        for (let i = 0; i < barCount; i++) {
          const barHeight = (dataArray[i] / 255) * canvas.height * 0.8;
          const hue = (i / barCount) * 60 + 180; // Blue to cyan gradient
          
          ctx.fillStyle = `hsla(${hue}, 100%, 50%, 0.6)`;
          ctx.fillRect(
            i * barWidth,
            canvas.height - barHeight,
            barWidth - 2,
            barHeight
          );
        }
        
        animationFrameRef.current = requestAnimationFrame(animate);
      };
      
      animate();
    } catch (error) {
      console.error('Failed to start audio visualization:', error);
    }
  }, []);

  const stopAudioVisualization = useCallback(() => {
    if (animationFrameRef.current) {
      cancelAnimationFrame(animationFrameRef.current);
    }
    if (audioContextRef.current) {
      audioContextRef.current.close();
    }
    setAudioLevel(0);
  }, []);

  // Agent Brady - Voice Agent Integration
  const startVoiceSession = useCallback(async () => {
    try {
      setAgentStatus('listening');
      await startAudioVisualization();
      
      // Initialize ElevenLabs Conversational AI for Agent Brady
      const { Conversation } = await import('@elevenlabs/client');
      
      const conversation = await Conversation.startSession({
        agentId: ELEVENLABS_AGENT_ID,
        onConnect: () => {
          console.log('Agent Brady connected');
          setIsVoiceActive(true);
          setConversationHistory(prev => [{
            role: 'agent',
            message: "Agent Brady online. Maritime command center ready. How can I assist with fleet monitoring?",
            timestamp: new Date()
          }, ...prev]);
        },
        onDisconnect: () => {
          console.log('Agent Brady disconnected');
          setIsVoiceActive(false);
          setAgentStatus('idle');
        },
        onMessage: (message: any) => {
          console.log('Agent Brady:', message);
          
          if (message.type === 'user_transcript') {
            setConversationHistory(prev => [{
              role: 'user',
              message: message.text,
              timestamp: new Date()
            }, ...prev]);
            setAgentStatus('thinking');
          }
          
          if (message.type === 'agent_response') {
            setConversationHistory(prev => [{
              role: 'agent',
              message: message.text,
              timestamp: new Date()
            }, ...prev]);
            setAgentStatus('speaking');
            
            // Parse commands from Agent Brady
            handleVoiceCommand(message.text);
          }
          
          if (message.type === 'audio_end') {
            setAgentStatus('listening');
          }
        },
        onError: (error: any) => {
          console.error('Agent Brady error:', error);
          setIsVoiceActive(false);
          setAgentStatus('idle');
        }
      });
      
      conversationRef.current = conversation;
    } catch (error) {
      console.error('Failed to start Agent Brady:', error);
      setAgentStatus('idle');
    }
  }, [startAudioVisualization]);

  const stopVoiceSession = useCallback(() => {
    if (conversationRef.current) {
      conversationRef.current.endSession();
      conversationRef.current = null;
    }
    stopAudioVisualization();
    setIsVoiceActive(false);
    setAgentStatus('idle');
    setConversationHistory(prev => [{
      role: 'agent',
      message: "Agent Brady signing off. Command center standing by.",
      timestamp: new Date()
    }, ...prev]);
  }, [stopAudioVisualization]);

  const toggleVoice = useCallback(() => {
    if (isVoiceActive) {
      stopVoiceSession();
    } else {
      startVoiceSession();
    }
  }, [isVoiceActive, startVoiceSession, stopVoiceSession]);

  // Handle voice commands
  const handleVoiceCommand = useCallback((command: string) => {
    const cmd = command.toLowerCase();
    
    // Agent Brady understands maritime monitoring commands
    if (cmd.includes('refresh') || cmd.includes('update') || cmd.includes('reload')) {
      refreshAll();
    } else if (cmd.includes('alert') || cmd.includes('warning') || cmd.includes('critical')) {
      document.getElementById('alerts-section')?.scrollIntoView({ behavior: 'smooth' });
    } else if (cmd.includes('fleet') || cmd.includes('vessel')) {
      fetchFleetAnalysis();
    } else if (cmd.includes('transaction') || cmd.includes('blockchain')) {
      fetchMonitoringData();
    } else if (cmd.includes('anomaly') || cmd.includes('suspicious')) {
      // Trigger anomaly detection
      fetch('http://127.0.0.1:8000/monitoring/anomalies', {
        headers: { 'Authorization': `Bearer ${accessToken}` }
      }).then(res => res.json()).then(data => {
        console.log('Anomalies:', data);
      });
    }
  }, [refreshAll, fetchFleetAnalysis, fetchMonitoringData, accessToken]);

  if (isLoading) {
    return (
      <div className="flex items-center justify-center min-h-screen bg-[#171717]">
        <div className="text-[#e0f2fd]">Loading...</div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-[#171717] text-[#e0f2fd] p-8">
      {/* Header */}
      <div className="flex items-center justify-between mb-8">
        <div className="flex items-center gap-4">
          <FiActivity className="w-8 h-8 text-[#4662ab]" />
          <h1 className="text-3xl font-bold">Live Monitoring Command Center</h1>
        </div>
        
        <div className="flex items-center gap-4">
          {/* Agent Brady Voice Control */}
          <button
            onClick={toggleVoice}
            className={`flex items-center gap-2 px-6 py-3 rounded-lg font-semibold transition-all shadow-lg ${
              isVoiceActive
                ? 'bg-gradient-to-r from-red-600 to-red-700 hover:from-red-700 hover:to-red-800 text-white animate-pulse shadow-red-500/50'
                : 'bg-gradient-to-r from-[#4662ab] to-[#5773bc] hover:from-[#5773bc] hover:to-[#4662ab] text-white shadow-[#4662ab]/50'
            }`}
          >
            {isVoiceActive ? (
              <>
                <FiMicOff className="w-5 h-5" />
                <span>Disconnect Agent Brady</span>
              </>
            ) : (
              <>
                <FiMic className="w-5 h-5" />
                <span>üéôÔ∏è Activate Agent Brady</span>
              </>
            )}
          </button>

          {/* Refresh Button */}
          <button
            onClick={refreshAll}
            disabled={isRefreshing}
            className="flex items-center gap-2 px-4 py-2 bg-[#4662ab] hover:bg-[#5773bc] text-white rounded-lg transition-colors disabled:opacity-50"
          >
            <FiRefreshCw className={`w-5 h-5 ${isRefreshing ? 'animate-spin' : ''}`} />
            <span>Refresh</span>
          </button>
          
          <div className="text-sm text-[#c0d9ef]">
            Last update: {lastUpdate.toLocaleTimeString()}
          </div>
        </div>
      </div>

      {/* AGENT BRADY - COMMAND CENTER INTERFACE */}
      {isVoiceActive && (
        <div className="mb-8 relative overflow-hidden">
          {/* Background glow effects */}
          <div className="absolute inset-0 bg-gradient-to-r from-cyan-500/10 via-blue-500/10 to-purple-500/10 blur-3xl animate-pulse" />
          
          <div className="relative bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 border-2 border-cyan-400/50 rounded-2xl shadow-2xl shadow-cyan-500/20 overflow-hidden">
            {/* Animated border glow */}
            <div className="absolute inset-0 bg-gradient-to-r from-transparent via-cyan-400/20 to-transparent animate-[shimmer_2s_infinite]" />
            
            <div className="relative p-8">
              {/* Header Section */}
              <div className="flex items-start gap-6 mb-6">
                {/* Advanced Avatar with Animations */}
                <div className="relative flex-shrink-0">
                  {/* Outer pulsing ring */}
                  <div className={`absolute inset-0 rounded-full blur-xl ${
                    agentStatus === 'listening' ? 'bg-green-400/60 animate-pulse' :
                    agentStatus === 'thinking' ? 'bg-yellow-400/60 animate-pulse' :
                    agentStatus === 'speaking' ? 'bg-cyan-400/60 animate-pulse' :
                    'bg-cyan-400/30'
                  }`} />
                  
                  {/* Middle ring */}
                  <div className={`absolute -inset-2 rounded-full border-2 ${
                    agentStatus === 'listening' ? 'border-green-400 animate-spin-slow' :
                    agentStatus === 'thinking' ? 'border-yellow-400 animate-spin' :
                    agentStatus === 'speaking' ? 'border-cyan-400 animate-spin-slow' :
                    'border-cyan-400/50'
                  }`} style={{ animationDuration: '3s' }} />
                  
                  {/* Avatar circle */}
                  <div className={`relative w-28 h-28 rounded-full bg-gradient-to-br from-cyan-400 via-blue-500 to-purple-600 p-1 shadow-2xl ${
                    agentStatus !== 'idle' ? 'animate-pulse' : ''
                  }`}>
                    <div className="w-full h-full rounded-full bg-slate-900 flex items-center justify-center">
                      {/* Custom AI Brain SVG */}
                      <svg className="w-16 h-16" viewBox="0 0 64 64" fill="none">
                        <circle cx="32" cy="32" r="28" stroke="url(#gradient1)" strokeWidth="2" />
                        <path d="M20 32 L28 28 L36 32 L44 28" stroke="url(#gradient2)" strokeWidth="2" strokeLinecap="round" />
                        <path d="M20 40 L28 36 L36 40 L44 36" stroke="url(#gradient2)" strokeWidth="2" strokeLinecap="round" />
                        <path d="M20 24 L28 20 L36 24 L44 20" stroke="url(#gradient2)" strokeWidth="2" strokeLinecap="round" />
                        <circle cx="22" cy="26" r="3" fill="#00d9ff" className="animate-pulse" />
                        <circle cx="42" cy="26" r="3" fill="#00d9ff" className="animate-pulse" />
                        <circle cx="32" cy="18" r="3" fill="#a855f7" className="animate-pulse" />
                        <defs>
                          <linearGradient id="gradient1" x1="0" y1="0" x2="64" y2="64">
                            <stop offset="0%" stopColor="#00d9ff" />
                            <stop offset="100%" stopColor="#a855f7" />
                          </linearGradient>
                          <linearGradient id="gradient2" x1="0" y1="0" x2="64" y2="0">
                            <stop offset="0%" stopColor="#00d9ff" />
                            <stop offset="100%" stopColor="#a855f7" />
                          </linearGradient>
                        </defs>
                      </svg>
                    </div>
                  </div>
                  
                  {/* Status indicator */}
                  <div className={`absolute -bottom-2 -right-2 px-3 py-1.5 rounded-full font-bold text-xs shadow-lg ${
                    agentStatus === 'listening' ? 'bg-green-500 text-white' :
                    agentStatus === 'thinking' ? 'bg-yellow-500 text-black' :
                    agentStatus === 'speaking' ? 'bg-cyan-500 text-white' :
                    'bg-slate-700 text-white'
                  }`}>
                    {agentStatus === 'listening' ? '‚óè REC' : 
                     agentStatus === 'thinking' ? '‚óè PROC' : 
                     agentStatus === 'speaking' ? '‚óè LIVE' : 
                     '‚óã IDLE'}
                  </div>
                </div>

                {/* Agent Info */}
                <div className="flex-1">
                  <div className="flex items-center justify-between mb-2">
                    <div>
                      <h2 className="text-3xl font-bold bg-gradient-to-r from-cyan-400 to-purple-400 bg-clip-text text-transparent">
                        AGENT BRADY
                      </h2>
                      <p className={`text-sm font-mono mt-1 ${
                        agentStatus === 'listening' ? 'text-green-400' :
                        agentStatus === 'thinking' ? 'text-yellow-400' :
                        agentStatus === 'speaking' ? 'text-cyan-400' :
                        'text-slate-400'
                      }`}>
                        {agentStatus === 'listening' ? '‚ñ∫ AUDIO INPUT ACTIVE' :
                         agentStatus === 'thinking' ? '‚ñ∫ NEURAL PROCESSING' :
                         agentStatus === 'speaking' ? '‚ñ∫ TRANSMITTING RESPONSE' :
                         '‚ñ∫ STANDBY MODE'}
                      </p>
                    </div>
                    <div className="flex gap-2">
                      <div className="px-3 py-1 bg-cyan-500/20 border border-cyan-400/50 rounded-full text-xs font-mono text-cyan-300">
                        MARITIME OPS
                      </div>
                      <div className="px-3 py-1 bg-purple-500/20 border border-purple-400/50 rounded-full text-xs font-mono text-purple-300">
                        AI EXPERT
                      </div>
                    </div>
                  </div>
                  
                  {/* System stats */}
                  <div className="grid grid-cols-4 gap-2 mt-3">
                    <div className="bg-slate-800/50 border border-slate-700 rounded px-2 py-1 text-center">
                      <div className="text-xs text-slate-400 font-mono">VESSELS</div>
                      <div className="text-lg font-bold text-cyan-400">{metrics?.active_vessels || 0}</div>
                    </div>
                    <div className="bg-slate-800/50 border border-slate-700 rounded px-2 py-1 text-center">
                      <div className="text-xs text-slate-400 font-mono">TX/DAY</div>
                      <div className="text-lg font-bold text-purple-400">{metrics?.transactions_today || 0}</div>
                    </div>
                    <div className="bg-slate-800/50 border border-slate-700 rounded px-2 py-1 text-center">
                      <div className="text-xs text-slate-400 font-mono">ALERTS</div>
                      <div className="text-lg font-bold text-yellow-400">{metrics?.active_alerts || 0}</div>
                    </div>
                    <div className="bg-slate-800/50 border border-slate-700 rounded px-2 py-1 text-center">
                      <div className="text-xs text-slate-400 font-mono">SYNC</div>
                      <div className="text-lg font-bold text-green-400">‚óè</div>
                    </div>
                  </div>
                </div>
              </div>

              {/* PROFESSIONAL WAVEFORM VISUALIZATION */}
              <div className="bg-black/50 rounded-xl p-4 border border-cyan-400/30 shadow-inner mb-4">
                <div className="flex items-center justify-between mb-2">
                  <span className="text-xs font-mono text-cyan-400">‚óÜ AUDIO SPECTRUM ANALYZER</span>
                  <span className="text-xs font-mono text-slate-400">LEVEL: {Math.round(Math.abs(audioLevel) * 100)}%</span>
                </div>
                <canvas 
                  ref={canvasRef}
                  width={1200}
                  height={200}
                  className="w-full h-48 rounded-lg"
                  style={{ backgroundColor: '#0a0a0a' }}
                />
              </div>

              {/* Conversation Transcript */}
              <div className="bg-slate-800/30 rounded-xl p-4 border border-slate-700">
                <div className="text-xs font-mono text-slate-400 mb-3 flex items-center gap-2">
                  <span className="w-2 h-2 bg-green-400 rounded-full animate-pulse" />
                  CONVERSATION TRANSCRIPT
                </div>
                <div className="space-y-2 max-h-40 overflow-y-auto">
                  {conversationHistory.slice(0, 5).map((msg, i) => (
                    <div key={i} className={`p-3 rounded-lg border ${
                      msg.role === 'agent' 
                        ? 'bg-cyan-500/10 border-cyan-400/30 text-cyan-100' 
                        : 'bg-purple-500/10 border-purple-400/30 text-purple-100'
                    }`}>
                      <div className="flex items-start gap-2">
                        <div className={`px-2 py-0.5 rounded text-xs font-bold ${
                          msg.role === 'agent' ? 'bg-cyan-500 text-white' : 'bg-purple-500 text-white'
                        }`}>
                          {msg.role === 'agent' ? 'BRADY' : 'USER'}
                        </div>
                        <div className="flex-1 text-sm">{msg.message}</div>
                        <div className="text-xs text-slate-500 font-mono">
                          {msg.timestamp.toLocaleTimeString()}
                        </div>
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            </div>
          </div>
        </div>
      )}

      {/* AI Summary Card */}
      {aiSummary && !isVoiceActive && (
        <div className="mb-8 p-6 bg-gradient-to-r from-[#4662ab33] to-[#4662ab1f] border border-[#4662ab] rounded-xl">
          <div className="flex items-start gap-3">
            <FiActivity className="w-6 h-6 text-[#4662ab] flex-shrink-0 mt-1" />
            <div>
              <h3 className="text-lg font-semibold mb-2">AI-Powered Insights</h3>
              <p className="text-[#d2deea]">{aiSummary}</p>
            </div>
          </div>
        </div>
      )}

      {/* Metrics Grid */}
      {metrics && (
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
          <MetricCard
            title="Active Vessels"
            value={metrics.active_vessels}
            subtitle={`${metrics.fishing_vessels} fishing`}
            icon="üö¢"
          />
          <MetricCard
            title="Transactions Today"
            value={metrics.transactions_today}
            subtitle="Blockchain verified"
            icon="‚õìÔ∏è"
          />
          <MetricCard
            title="Active Alerts"
            value={metrics.active_alerts}
            subtitle={metrics.active_alerts > 0 ? 'Requires attention' : 'All clear'}
            icon="‚ö†Ô∏è"
            isAlert={metrics.active_alerts > 0}
          />
          <MetricCard
            title="System Health"
            value={metrics.system_health}
            subtitle="All systems operational"
            icon="üíö"
            isStatus
          />
          <MetricCard
            title="Blockchain Status"
            value={metrics.blockchain_sync}
            subtitle="Real-time sync"
            icon="üîó"
            isStatus
          />
        </div>
      )}

      <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
        {/* Alerts Section */}
        <div id="alerts-section" className="bg-[#1a1a1a] border border-[rgba(198,218,236,0.22)] rounded-xl p-6">
          <h2 className="text-xl font-semibold mb-4 flex items-center gap-2">
            <FiAlertCircle className="text-orange-500" />
            Active Alerts
          </h2>
          <div className="space-y-3">
            {alerts.length > 0 ? (
              alerts.map((alert) => (
                <AlertCard key={alert.id} alert={alert} />
              ))
            ) : (
              <div className="text-center py-8 text-[#c0d9ef]">
                <FiCheckCircle className="w-12 h-12 mx-auto mb-2 text-green-500" />
                <p>No active alerts</p>
              </div>
            )}
          </div>
        </div>

        {/* Live Feed */}
        <div className="bg-[#1a1a1a] border border-[rgba(198,218,236,0.22)] rounded-xl p-6">
          <h2 className="text-xl font-semibold mb-4">Live Activity Feed</h2>
          <div className="space-y-2 max-h-96 overflow-y-auto">
            {liveEvents.map((event) => (
              <LiveEventCard key={event.id} event={event} />
            ))}
          </div>
        </div>
      </div>

      {/* Fleet Analysis */}
      {fleetAnalysis && (
        <div className="mt-8 bg-[#1a1a1a] border border-[rgba(198,218,236,0.22)] rounded-xl p-6">
          <h2 className="text-xl font-semibold mb-4">Fleet Analysis</h2>
          <p className="text-[#d2deea] whitespace-pre-wrap">{fleetAnalysis}</p>
        </div>
      )}
    </div>
  );
}

// Metric Card Component
function MetricCard({ title, value, subtitle, icon, isAlert = false, isStatus = false }: any) {
  return (
    <div className={`p-6 rounded-xl border transition-all ${
      isAlert 
        ? 'bg-orange-900/20 border-orange-500/50' 
        : 'bg-[#1a1a1a] border-[rgba(198,218,236,0.22)] hover:border-[#4662ab]'
    }`}>
      <div className="flex items-start justify-between mb-2">
        <h3 className="text-sm font-medium text-[#c0d9ef]">{title}</h3>
        <span className="text-2xl">{icon}</span>
      </div>
      <div className={`text-3xl font-bold mb-1 ${
        isStatus ? 'capitalize' : ''
      }`}>
        {value}
      </div>
      <div className="text-sm text-[#c0d9ef]">{subtitle}</div>
    </div>
  );
}

// Alert Card Component
function AlertCard({ alert }: { alert: Alert }) {
  const severityColors = {
    CRITICAL: 'border-red-500 bg-red-900/20',
    HIGH: 'border-orange-500 bg-orange-900/20',
    MEDIUM: 'border-yellow-500 bg-yellow-900/20',
    LOW: 'border-blue-500 bg-blue-900/20'
  };

  return (
    <div className={`p-4 rounded-lg border ${severityColors[alert.severity as keyof typeof severityColors] || 'border-gray-500'}`}>
      <div className="flex items-start justify-between">
        <div>
          <div className="flex items-center gap-2 mb-1">
            <span className="text-xs font-semibold uppercase">{alert.severity}</span>
            <span className="text-xs text-[#c0d9ef]">{alert.type}</span>
          </div>
          <p className="text-sm">{alert.message}</p>
        </div>
        <div className="text-xs text-[#c0d9ef] whitespace-nowrap">
          {new Date(alert.timestamp).toLocaleTimeString()}
        </div>
      </div>
    </div>
  );
}

// Live Event Card Component
function LiveEventCard({ event }: { event: LiveEvent }) {
  return (
    <div className="flex items-start gap-3 p-3 rounded-lg bg-[#171717] border border-[rgba(198,218,236,0.15)] hover:border-[#4662ab] transition-colors">
      <div className="text-2xl flex-shrink-0">
        {event.type === 'transaction' ? '‚õìÔ∏è' : event.type === 'vessel' ? 'üö¢' : 'üìç'}
      </div>
      <div className="flex-1 min-w-0">
        <p className="text-sm text-[#e0f2fd]">{event.description}</p>
        <div className="text-xs text-[#c0d9ef] mt-1">
          {new Date(event.timestamp).toLocaleString()}
        </div>
      </div>
    </div>
  );
}
